<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Market Trend Summarizer | AI-Powered Trend Analysis</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 15px 30px;
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
            color: white;
            font-size: 1.5rem;
            font-weight: 700;
        }

        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
        }

        .nav-actions {
            display: flex;
            gap: 15px;
        }

        .nav-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            padding: 10px 15px;
            border-radius: 10px;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .hero {
            text-align: center;
            margin-bottom: 50px;
            color: white;
        }

        .hero h1 {
            font-size: 4rem;
            font-weight: 800;
            margin-bottom: 20px;
            background: linear-gradient(135deg, #fff, #f0f0f0);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .hero p {
            font-size: 1.3rem;
            opacity: 0.9;
            margin-bottom: 30px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        .hero-features {
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .hero-feature {
            display: flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 12px 20px;
            border-radius: 25px;
            backdrop-filter: blur(10px);
            transition: all 0.3s ease;
        }

        .hero-feature:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .auth-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 50px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            max-width: 500px;
            margin: 0 auto;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 40px;
        }

        .auth-header h2 {
            color: #333;
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .auth-header p {
            color: #666;
            font-size: 1rem;
        }

        .main-app {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
            margin-bottom: 30px;
        }

        .user-dashboard {
            background: linear-gradient(135deg, #8a2be2 0%, #4b0082 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            margin-bottom: 40px;
        }

        .user-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .user-badge {
            background: rgba(255, 255, 255, 0.2);
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .usage-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: linear-gradient(135deg, #8a2be2 0%, #4b0082 100%);
            color: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            margin-bottom: 10px;
        }

        .analysis-section {
            margin-bottom: 40px;
        }

        .section-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .section-header h2 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .section-header p {
            color: #666;
            font-size: 1.1rem;
        }

        .analysis-tabs {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .tab-card {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.9), rgba(75, 0, 130, 0.9));
            border-radius: 18px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 200px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            color: white;
            border: 2px solid transparent;
        }

        .tab-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.3);
        }

        .tab-card.active {
            transform: translateY(-8px);
            border-color: rgba(255, 255, 255, 0.5);
            box-shadow: 0 15px 35px rgba(138, 43, 226, 0.4);
        }

        .tab-icon {
            font-size: 2rem;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            width: 60px;
            height: 60px;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 15px;
        }

        .tab-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 8px;
            text-align: center;
        }

        .tab-description {
            font-size: 0.85rem;
            text-align: center;
            opacity: 0.9;
            line-height: 1.4;
        }

        /* FIXED: Simple tab content visibility */
        .tab-content {
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .chat-interface {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            margin-top: 30px;
            overflow: hidden;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.1);
        }

        .chat-header {
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
            padding: 25px 30px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .chat-header-icon {
            width: 60px;
            height: 60px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .chat-header h3 {
            margin-bottom: 5px;
        }

        .chat-header p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .chat-body {
            padding: 40px;
        }

        .chat-textarea {
            width: 100%;
            min-height: 140px;
            border: 2px solid rgba(138, 43, 226, 0.2);
            border-radius: 20px;
            padding: 30px 25px 25px 25px;
            font-size: 16px;
            font-family: inherit;
            resize: vertical;
            transition: all 0.3s ease;
        }

        .chat-textarea:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }

        .chat-textarea-label {
            position: absolute;
            top: -15px;
            left: 20px;
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
            padding: 10px 20px;
            font-weight: 600;
            border-radius: 25px;
            font-size: 0.9rem;
        }

        .chat-suggestions {
            display: flex;
            gap: 12px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .suggestion-chip {
            background: rgba(138, 43, 226, 0.1);
            border: 2px solid rgba(138, 43, 226, 0.2);
            padding: 12px 20px;
            border-radius: 30px;
            cursor: pointer;
            color: #8a2be2;
            font-weight: 500;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .suggestion-chip:hover {
            background: #8a2be2;
            color: white;
            transform: translateY(-2px);
        }

        .chat-input-row {
            display: flex;
            gap: 20px;
            margin-bottom: 35px;
        }

        .chat-input-row input {
            flex: 1;
            padding: 20px 25px;
            border: 2px solid rgba(138, 43, 226, 0.2);
            border-radius: 18px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .chat-input-row input:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }

        .chat-submit-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 25px;
        }

        .chat-submit-btn {
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
            border: none;
            padding: 20px 40px;
            border-radius: 18px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 12px;
            transition: all 0.3s ease;
        }

        .chat-submit-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3);
        }

        .chat-submit-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .chat-features {
            display: flex;
            gap: 25px;
            color: #666;
            font-size: 0.9rem;
            align-items: center;
        }

        .chat-feature {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 600;
            color: #333;
        }

        .form-control {
            width: 100%;
            padding: 15px 20px;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: #8a2be2;
            box-shadow: 0 0 0 3px rgba(138, 43, 226, 0.1);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .file-upload-area {
            border: 3px dashed #cbd5e0;
            border-radius: 20px;
            padding: 50px;
            text-align: center;
            cursor: pointer;
            background: white;
            transition: all 0.3s ease;
        }

        .file-upload-area:hover {
            border-color: #8a2be2;
            background: rgba(138, 43, 226, 0.02);
        }

        .file-upload-area.dragover {
            border-color: #8a2be2;
            background: rgba(138, 43, 226, 0.05);
        }

        .file-upload-icon {
            font-size: 4rem;
            color: #8a2be2;
            margin-bottom: 20px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 15px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #8a2be2, #4b0082);
            color: white;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(138, 43, 226, 0.3);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results-container {
            margin-top: 40px;
            background: white;
            border-radius: 20px;
            padding: 40px;
            border-left: 5px solid #8a2be2;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            animation: slideUp 0.5s ease;
        }

        @keyframes slideUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .results-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 30px;
            color: #8a2be2;
        }

        .insight-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            border-left: 4px solid #8a2be2;
            transition: all 0.3s ease;
        }

        .insight-card:hover {
            transform: translateX(5px);
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
        }

        .insight-card h4 {
            color: #8a2be2;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.1rem;
        }

        .insight-card p {
            line-height: 1.6;
            color: #333;
        }

        .insight-card ul {
            margin: 10px 0;
            padding-left: 20px;
        }

        .insight-card li {
            margin-bottom: 8px;
            line-height: 1.5;
        }

        .loading {
            text-align: center;
            padding: 60px;
            color: #8a2be2;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #8a2be2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .message {
            padding: 15px 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .error {
            background: #ff6b6b;
            color: white;
        }

        .success {
            background: #4caf50;
            color: white;
        }

        .platform-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 10px;
            margin-bottom: 20px;
        }

        .platform-chip {
            background: rgba(138, 43, 226, 0.1);
            border: 2px solid rgba(138, 43, 226, 0.2);
            padding: 12px 15px;
            border-radius: 20px;
            text-align: center;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .platform-chip:hover {
            background: rgba(138, 43, 226, 0.2);
        }

        .platform-chip.selected {
            background: #8a2be2;
            color: white;
        }

        @media (max-width: 1200px) {
            .analysis-tabs {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .hero h1 {
                font-size: 3rem;
            }
        }

        @media (max-width: 768px) {
            .analysis-tabs {
                grid-template-columns: 1fr;
            }
            
            .chat-input-row {
                flex-direction: column;
            }
            
            .chat-submit-container {
                flex-direction: column;
                align-items: stretch;
            }
            
            .chat-features {
                justify-content: center;
                margin-bottom: 20px;
            }
            
            .hero h1 {
                font-size: 2.5rem;
            }
            
            .hero p {
                font-size: 1.1rem;
            }
            
            .hero-features {
                gap: 15px;
            }
            
            .hero-feature {
                font-size: 0.9rem;
            }
            
            .auth-container {
                padding: 30px;
            }
            
            .main-app {
                padding: 25px;
            }
            
            .user-info {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }
        }

        @media (max-width: 480px) {
            .container {
                padding: 10px;
            }
            
            .navbar {
                padding: 10px 20px;
                flex-direction: column;
                gap: 15px;
            }
            
            .logo {
                font-size: 1.3rem;
            }
            
            .usage-stats {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body x-data="app()" x-init="init()">
    <div class="navbar" x-show="isAuthenticated">
        <div class="logo">
            <div class="logo-icon">
                <i class="fas fa-chart-line"></i>
            </div>
            <span>Market Trend Summarizer</span>
        </div>
        <div class="nav-actions">
            <button class="nav-btn" @click="clearCache()" title="Clear Cache">
                <i class="fas fa-trash"></i>
            </button>
            <button class="nav-btn" @click="logout()" title="Logout">
                <i class="fas fa-sign-out-alt"></i>
            </button>
        </div>
    </div>

    <div class="container">
        <div x-show="!isAuthenticated" class="hero">
            <h1>Market Trend Summarizer</h1>
            <p>Understand the Market in Minutes â€” Not Hours. Our AI-powered trend summarizer uses large language models to scan Reddit, YouTube, Twitter, and articles and delivers clear, insight-rich summaries with sentiment analysis and competitor tracking.</p>
            
            <div class="hero-features">
                <div class="hero-feature">
                    <i class="fas fa-share-alt"></i>
                    <span>Social Media Scanning</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-heart"></i>
                    <span>Sentiment Analysis</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-hashtag"></i>
                    <span>Hashtag Suggestions</span>
                </div>
                <div class="hero-feature">
                    <i class="fas fa-file-pdf"></i>
                    <span>PDF Reports</span>
                </div>
            </div>
        </div>

        <div x-show="!isAuthenticated" class="auth-container">
            <div x-show="authMode === 'login'">
                <div class="auth-header">
                    <h2><i class="fas fa-sign-in-alt"></i> Welcome Back</h2>
                    <p>Sign in to access your market trend analysis dashboard</p>
                </div>
                <form @submit.prevent="login()">
                    <div class="form-group">
                        <label for="email">Email Address</label>
                        <input type="email" id="email" class="form-control" x-model="credentials.email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" class="form-control" x-model="credentials.password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" :disabled="loading">
                        <i class="fas fa-sign-in-alt"></i>
                        <span x-text="loading ? 'Signing In...' : 'Sign In'"></span>
                    </button>
                </form>
                <p style="text-align: center; margin-top: 25px;">
                    Don't have an account? 
                    <a href="#" @click="authMode = 'signup'" style="color: #8a2be2; text-decoration: none;">Create Account</a>
                </p>
            </div>

            <div x-show="authMode === 'signup'">
                <div class="auth-header">
                    <h2><i class="fas fa-user-plus"></i> Create Account</h2>
                    <p>Join marketers, founders, and creators using our AI platform</p>
                </div>
                <form @submit.prevent="signup()">
                    <div class="form-group">
                        <label for="signup-email">Email Address</label>
                        <input type="email" id="signup-email" class="form-control" x-model="credentials.email" required>
                    </div>
                    <div class="form-group">
                        <label for="signup-password">Password</label>
                        <input type="password" id="signup-password" class="form-control" x-model="credentials.password" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" :disabled="loading">
                        <i class="fas fa-user-plus"></i>
                        <span x-text="loading ? 'Creating Account...' : 'Create Account'"></span>
                    </button>
                </form>
                <p style="text-align: center; margin-top: 25px;">
                    Already have an account? 
                    <a href="#" @click="authMode = 'login'" style="color: #8a2be2; text-decoration: none;">Sign In</a>
                </p>
            </div>

            <div x-show="message" :class="'message ' + messageType" x-text="message"></div>
        </div>

        <div x-show="isAuthenticated" class="main-app">
            <div class="user-dashboard">
                <div class="user-info">
                    <div>
                        <h3><i class="fas fa-user-circle"></i> Welcome back!</h3>
                        <p x-text="user?.email"></p>
                    </div>
                    <div class="user-badge" x-text="user?.subscription_type || 'Free Plan'"></div>
                </div>
            </div>

            <div class="usage-stats">
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-chart-line"></i></div>
                    <h4>Trend Analysis</h4>
                    <div class="stat-value" x-text="`${user?.usage?.summary || 0}/${user?.limits?.summary || 10}`"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-share-alt"></i></div>
                    <h4>Social Scans</h4>
                    <div class="stat-value" x-text="`${user?.usage?.analysis || 0}/${user?.limits?.analysis || 5}`"></div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon"><i class="fas fa-heart"></i></div>
                    <h4>Sentiment Reports</h4>
                    <div class="stat-value" x-text="`${user?.usage?.question || 0}/${user?.limits?.question || 20}`"></div>
                </div>
            </div>

            <div class="analysis-section">
                <div class="section-header">
                    <h2>Choose Your Analysis Type</h2>
                    <p>Select the type of market trend analysis you want to perform</p>
                </div>

                <div class="analysis-tabs">
                    <div class="tab-card" :class="{ active: activeTab === 'comprehensive' }" @click="activeTab = 'comprehensive'">
                        <div class="tab-icon"><i class="fas fa-brain"></i></div>
                        <div class="tab-title">Comprehensive Analysis</div>
                        <div class="tab-description">Full market analysis with sentiment, mentions, and hashtag suggestions.</div>
                    </div>
                    <div class="tab-card" :class="{ active: activeTab === 'social' }" @click="activeTab = 'social'">
                        <div class="tab-icon"><i class="fas fa-share-alt"></i></div>
                        <div class="tab-title">Social Media Scan</div>
                        <div class="tab-description">Scan Reddit, YouTube, and Twitter for trending topics.</div>
                    </div>
                    <div class="tab-card" :class="{ active: activeTab === 'text' }" @click="activeTab = 'text'">
                        <div class="tab-icon"><i class="fas fa-file-text"></i></div>
                        <div class="tab-title">Text Analysis</div>
                        <div class="tab-description">Analyze text content for trends and sentiment.</div>
                    </div>
                    <div class="tab-card" :class="{ active: activeTab === 'url' }" @click="activeTab = 'url'">
                        <div class="tab-icon"><i class="fas fa-globe"></i></div>
                        <div class="tab-title">URL Analysis</div>
                        <div class="tab-description">Extract and analyze content from websites.</div>
                    </div>
                    <div class="tab-card" :class="{ active: activeTab === 'file' }" @click="activeTab = 'file'">
                        <div class="tab-icon"><i class="fas fa-cloud-upload-alt"></i></div>
                        <div class="tab-title">Document Analysis</div>
                        <div class="tab-description">Upload and analyze documents and files.</div>
                    </div>
                </div>

                <div x-show="activeTab === 'comprehensive'" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="chat-header-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h3>AI Market Trend Analyzer</h3>
                                <p>Get comprehensive market insights with sentiment analysis</p>
                            </div>
                        </div>
                        <div class="chat-body">
                            <form @submit.prevent="analyzeComprehensive()">
                                <div style="position: relative; margin-bottom: 30px;">
                                    <div class="chat-textarea-label">What market trend would you like to analyze?</div>
                                    <textarea class="chat-textarea" x-model="forms.comprehensive.text" 
                                            placeholder="Paste article content, social media posts, or enter your market research query here..."
                                            required></textarea>
                                </div>
                                
                                <div class="chat-suggestions">
                                    <div class="suggestion-chip" @click="forms.comprehensive.text = 'AI and machine learning trends in 2024'">AI trends</div>
                                    <div class="suggestion-chip" @click="forms.comprehensive.text = 'Sustainable energy market analysis'">Renewable energy</div>
                                    <div class="suggestion-chip" @click="forms.comprehensive.text = 'E-commerce growth and consumer behavior'">E-commerce</div>
                                </div>

                                <div class="chat-input-row">
                                    <input type="text" x-model="forms.comprehensive.url" placeholder="URL to analyze (optional)">
                                    <input type="text" x-model="forms.comprehensive.brands" placeholder="Brand names to track">
                                </div>

                                <div class="chat-submit-container">
                                    <div class="chat-features">
                                        <div class="chat-feature">
                                            <i class="fas fa-heart"></i>
                                            <span>Sentiment Analysis</span>
                                        </div>
                                        <div class="chat-feature">
                                            <i class="fas fa-hashtag"></i>
                                            <span>Hashtag Generation</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="chat-submit-btn" :disabled="loading">
                                        <i class="fas fa-search"></i>
                                        <span x-text="loading ? 'Analyzing...' : 'Get Market Insights'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'social'" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="chat-header-icon">
                                <i class="fas fa-share-alt"></i>
                            </div>
                            <div>
                                <h3>Social Media Scanner</h3>
                                <p>Scan Reddit, YouTube, and Twitter for trends</p>
                            </div>
                        </div>
                        <div class="chat-body">
                            <form @submit.prevent="analyzeSocial()">
                                <div style="position: relative; margin-bottom: 30px;">
                                    <div class="chat-textarea-label">What topic should we scan for?</div>
                                    <input type="text" class="chat-textarea" style="min-height: auto; padding: 20px;" 
                                           x-model="forms.social.query" 
                                           placeholder="e.g., Tesla Model 3, iPhone 15, climate change" required>
                                </div>
                                
                                <div class="form-group">
                                    <label>Select Platforms</label>
                                    <div class="platform-selector">
                                        <div class="platform-chip" :class="{ selected: forms.social.platforms.includes('reddit') }" 
                                             @click="togglePlatform('reddit')">Reddit</div>
                                        <div class="platform-chip" :class="{ selected: forms.social.platforms.includes('youtube') }" 
                                             @click="togglePlatform('youtube')">YouTube</div>
                                        <div class="platform-chip" :class="{ selected: forms.social.platforms.includes('twitter') }" 
                                             @click="togglePlatform('twitter')">Twitter</div>
                                    </div>
                                </div>

                                <div class="chat-submit-container">
                                    <div class="chat-features">
                                        <div class="chat-feature">
                                            <i class="fas fa-search"></i>
                                            <span>Multi-Platform Scan</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="chat-submit-btn" :disabled="loading">
                                        <i class="fas fa-search"></i>
                                        <span x-text="loading ? 'Scanning...' : 'Scan Social Media'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'text'" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="chat-header-icon">
                                <i class="fas fa-file-text"></i>
                            </div>
                            <div>
                                <h3>Text Analyzer</h3>
                                <p>Analyze text content for trends and sentiment</p>
                            </div>
                        </div>
                        <div class="chat-body">
                            <form @submit.prevent="analyzeText()">
                                <div style="position: relative; margin-bottom: 30px;">
                                    <div class="chat-textarea-label">Paste your text content here</div>
                                    <textarea class="chat-textarea" x-model="forms.text.text" 
                                            placeholder="Paste your text content here for analysis..." required></textarea>
                                </div>
                                
                                <div class="chat-input-row">
                                    <input type="text" x-model="forms.text.question" 
                                           placeholder="Analysis focus (optional)">
                                </div>

                                <div class="chat-submit-container">
                                    <div class="chat-features">
                                        <div class="chat-feature">
                                            <i class="fas fa-heart"></i>
                                            <span>Sentiment Analysis</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="chat-submit-btn" :disabled="loading">
                                        <i class="fas fa-search"></i>
                                        <span x-text="loading ? 'Analyzing...' : 'Analyze Text'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'url'" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="chat-header-icon">
                                <i class="fas fa-globe"></i>
                            </div>
                            <div>
                                <h3>URL Analyzer</h3>
                                <p>Extract and analyze content from websites</p>
                            </div>
                        </div>
                        <div class="chat-body">
                            <form @submit.prevent="analyzeUrl()">
                                <div style="position: relative; margin-bottom: 30px;">
                                    <div class="chat-textarea-label">Enter website URL</div>
                                    <input type="url" class="chat-textarea" style="min-height: auto; padding: 20px;" 
                                           x-model="forms.url.url" placeholder="https://example.com" required>
                                </div>
                                
                                <div class="chat-input-row">
                                    <input type="text" x-model="forms.url.question" 
                                           placeholder="Analysis focus (optional)">
                                </div>

                                <div class="chat-submit-container">
                                    <div class="chat-features">
                                        <div class="chat-feature">
                                            <i class="fas fa-link"></i>
                                            <span>Content Extraction</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="chat-submit-btn" :disabled="loading">
                                        <i class="fas fa-search"></i>
                                        <span x-text="loading ? 'Analyzing...' : 'Analyze URL'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <div x-show="activeTab === 'file'" class="tab-content">
                    <div class="chat-interface">
                        <div class="chat-header">
                            <div class="chat-header-icon">
                                <i class="fas fa-cloud-upload-alt"></i>
                            </div>
                            <div>
                                <h3>Document Analyzer</h3>
                                <p>Upload and analyze documents and files</p>
                            </div>
                        </div>
                        <div class="chat-body">
                            <form @submit.prevent="analyzeFile()">
                                <div class="form-group">
                                    <div class="file-upload-area" @click="$refs.fileInput.click()" 
                                         @drop.prevent="handleFileDrop" @dragover.prevent="handleDragOver"
                                         @dragleave.prevent="handleDragLeave">
                                        <div class="file-upload-icon">
                                            <i class="fas fa-cloud-upload-alt"></i>
                                        </div>
                                        <p x-show="!forms.file.file">
                                            <strong>Click to upload</strong> or drag and drop<br>
                                            <small>PDF, DOCX, TXT, PNG, JPG (max 16MB)</small>
                                        </p>
                                        <p x-show="forms.file.file" style="color: #8a2be2;">
                                            <i class="fas fa-check-circle"></i>
                                            <span x-text="forms.file.file?.name"></span>
                                        </p>
                                        <input type="file" x-ref="fileInput" @change="handleFileSelect" 
                                               accept=".pdf,.docx,.txt,.png,.jpg,.jpeg" style="display: none;">
                                    </div>
                                </div>
                                
                                <div class="chat-input-row">
                                    <input type="text" x-model="forms.file.question" 
                                           placeholder="Analysis question (optional)">
                                </div>

                                <div class="chat-submit-container">
                                    <div class="chat-features">
                                        <div class="chat-feature">
                                            <i class="fas fa-file-upload"></i>
                                            <span>Document Processing</span>
                                        </div>
                                    </div>
                                    <button type="submit" class="chat-submit-btn" :disabled="loading || !forms.file.file">
                                        <i class="fas fa-search"></i>
                                        <span x-text="loading ? 'Analyzing...' : 'Analyze Document'"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <div x-show="loading" class="loading">
                <div class="spinner"></div>
                <h3>Processing Your Analysis</h3>
                <p>Our AI is analyzing trends, detecting sentiment, and extracting insights...</p>
            </div>

            <div x-show="message" :class="'message ' + messageType">
                <i class="fas" :class="messageType === 'error' ? 'fa-exclamation-triangle' : 'fa-check-circle'"></i>
                <span x-text="message"></span>
            </div>

            <div x-show="results && !loading" class="results-container">
                <div class="results-header" style="display: flex; justify-content: space-between; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <i class="fas fa-chart-bar"></i>
                        <h3>Analysis Results</h3>
                    </div>
                    <button @click="exportToPDF()" class="btn btn-primary" style="font-size: 14px; padding: 12px 20px;">
                        <i class="fas fa-file-pdf"></i>
                        Export to PDF
                    </button>
                </div>
               
                
                <template x-if="results.summary">
                    <div class="insight-card">
                        <h4><i class="fas fa-file-alt"></i> Summary</h4>
                        <p x-text="results.summary"></p>
                    </div>
                </template>

                <template x-if="results.key_insights">
                    <div class="insight-card">
                        <h4><i class="fas fa-lightbulb"></i> Key Insights</h4>
                        <div x-html="formatInsights(results.key_insights)"></div>
                    </div>
                </template>

                <template x-if="results.recommendations">
                    <div class="insight-card">
                        <h4><i class="fas fa-tasks"></i> Recommendations</h4>
                        <div x-html="formatInsights(results.recommendations)"></div>
                    </div>
                </template>

                <template x-if="results.sentiment">
                    <div class="insight-card">
                        <h4><i class="fas fa-heart"></i> Sentiment Analysis</h4>
                        <p x-text="results.sentiment"></p>
                    </div>
                </template>

                <template x-if="results.hashtags">
                    <div class="insight-card">
                        <h4><i class="fas fa-hashtag"></i> Suggested Hashtags</h4>
                        <div x-html="formatHashtags(results.hashtags)"></div>
                    </div>
                </template>
            </div>
        </div>
    </div>

    <script>
        function app() {
            return {
                isAuthenticated: false, // Force this to false initially
                authMode: 'login',
                credentials: { email: '', password: '' },
                sessionId: '',
                user: null,
                activeTab: 'comprehensive',
                loading: false,
                message: '',
                messageType: '',
                results: null,
                forms: {
                    comprehensive: { text: '', url: '', brands: '' },
                    social: { query: '', platforms: ['reddit'] },
                    text: { text: '', question: '' },
                    url: { url: '', question: '' },
                    file: { file: null, question: '' }
                },
                apiBase: window.location.origin,

                init() {
                    console.log('App initializing...');
                    // Force show login form initially - don't auto-validate
                    this.isAuthenticated = false;
                    
                    // Only try to validate if we explicitly want to restore session
                    // Comment out the auto-validation for now:
                    /*
                    const savedSessionId = localStorage.getItem('sessionId');
                    console.log('Saved session ID:', savedSessionId);
                    
                    if (savedSessionId) {
                        this.sessionId = savedSessionId;
                        this.validateSession();
                    }
                    */
                },

                async validateSession() {
                    console.log('Validating session...');
                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/validate`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ session_id: this.sessionId })
                        });

                        console.log('Session validation response:', response.status);

                        if (response.ok) {
                            const data = await response.json();
                            console.log('Session valid, user data:', data.user);
                            this.isAuthenticated = true;
                            this.user = data.user;
                        } else {
                            console.log('Session invalid, clearing localStorage');
                            localStorage.removeItem('sessionId');
                            this.sessionId = '';
                            this.isAuthenticated = false;
                        }
                    } catch (error) {
                        console.error('Session validation error:', error);
                        localStorage.removeItem('sessionId');
                        this.sessionId = '';
                        this.isAuthenticated = false;
                    }
                },

                async login() {
                    this.loading = true;
                    this.message = '';

                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/login`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.credentials)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            this.sessionId = data.session_id;
                            this.user = data.user;
                            this.isAuthenticated = true;
                            localStorage.setItem('sessionId', this.sessionId);
                            this.showMessage('Welcome! Login successful.', 'success');
                            this.resetCredentials();
                        } else {
                            this.showMessage(data.error || 'Login failed', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Network error. Please try again.', 'error');
                    }

                    this.loading = false;
                },

                async signup() {
                    this.loading = true;
                    this.message = '';

                    try {
                        const response = await fetch(`${this.apiBase}/api/auth/signup`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(this.credentials)
                        });

                        const data = await response.json();

                        if (response.ok) {
                            this.sessionId = data.session_id;
                            this.user = data.user;
                            this.isAuthenticated = true;
                            localStorage.setItem('sessionId', this.sessionId);
                            this.showMessage('Account created successfully!', 'success');
                            this.resetCredentials();
                        } else {
                            this.showMessage(data.error || 'Signup failed', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Network error. Please try again.', 'error');
                    }

                    this.loading = false;
                },

                async logout() {
                    try {
                        await fetch(`${this.apiBase}/api/auth/logout`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ session_id: this.sessionId })
                        });
                    } catch (error) {
                        console.error('Logout error:', error);
                    }

                    this.isAuthenticated = false;
                    this.sessionId = '';
                    this.user = null;
                    this.results = null;
                    this.resetForms();
                    localStorage.removeItem('sessionId');
                    this.showMessage('Logged out successfully', 'success');
                },

                async analyzeComprehensive() {
                    await this.makeApiCall('/api/analyze/comprehensive', {
                        session_id: this.sessionId,
                        text: this.forms.comprehensive.text,
                        url: this.forms.comprehensive.url || null,
                        brands_list: this.forms.comprehensive.brands ? 
                            this.forms.comprehensive.brands.split(',').map(b => b.trim()).filter(b => b) : []
                    });
                },

                async analyzeSocial() {
                    if (this.forms.social.platforms.length === 0) {
                        this.showMessage('Please select at least one platform', 'error');
                        return;
                    }
                    
                    await this.makeApiCall('/api/analyze/social', {
                        session_id: this.sessionId,
                        query: this.forms.social.query,
                        platforms: this.forms.social.platforms
                    });
                },

                async analyzeText() {
                    await this.makeApiCall('/api/analyze/text', {
                        session_id: this.sessionId,
                        text: this.forms.text.text,
                        question: this.forms.text.question || null
                    });
                },

                async analyzeUrl() {
                    await this.makeApiCall('/api/analyze/url', {
                        session_id: this.sessionId,
                        url: this.forms.url.url,
                        question: this.forms.url.question || null
                    });
                },

                async analyzeFile() {
                    if (!this.forms.file.file) {
                        this.showMessage('Please select a file', 'error');
                        return;
                    }

                    this.loading = true;
                    this.message = '';
                    this.results = null;

                    try {
                        const formData = new FormData();
                        formData.append('session_id', this.sessionId);
                        formData.append('file', this.forms.file.file);
                        if (this.forms.file.question) {
                            formData.append('question', this.forms.file.question);
                        }

                        const response = await fetch(`${this.apiBase}/api/analyze/file`, {
                            method: 'POST',
                            body: formData
                        });

                        const data = await response.json();

                        if (response.ok) {
                            this.results = data;
                            await this.refreshUserInfo();
                            this.showMessage('Analysis completed successfully!', 'success');
                        } else {
                            this.showMessage(data.error || 'Analysis failed', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Network error. Please try again.', 'error');
                    }

                    this.loading = false;
                },

                async makeApiCall(endpoint, data) {
                    this.loading = true;
                    this.message = '';
                    this.results = null;

                    try {
                        const response = await fetch(`${this.apiBase}${endpoint}`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify(data)
                        });

                        const responseData = await response.json();

                        if (response.ok) {
                            this.results = responseData;
                            await this.refreshUserInfo();
                            this.showMessage('Analysis completed successfully!', 'success');
                        } else {
                            this.showMessage(responseData.error || 'Analysis failed', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Network error. Please try again.', 'error');
                    }

                    this.loading = false;
                },

                async refreshUserInfo() {
                    try {
                        const response = await fetch(`${this.apiBase}/api/user/info`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ session_id: this.sessionId })
                        });

                        if (response.ok) {
                            const data = await response.json();
                            this.user = data.user;
                        }
                    } catch (error) {
                        console.error('Error refreshing user info:', error);
                    }
                },

                async clearCache() {
                    try {
                        const response = await fetch(`${this.apiBase}/api/cache/clear`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ session_id: this.sessionId })
                        });

                        if (response.ok) {
                            this.showMessage('Cache cleared successfully', 'success');
                        } else {
                            this.showMessage('Failed to clear cache', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Failed to clear cache', 'error');
                    }
                },

                togglePlatform(platform) {
                    const platforms = this.forms.social.platforms;
                    const index = platforms.indexOf(platform);
                    if (index > -1) {
                        platforms.splice(index, 1);
                    } else {
                        platforms.push(platform);
                    }
                },

                handleFileSelect(event) {
                    const file = event.target.files[0];
                    if (file) {
                        if (file.size > 16 * 1024 * 1024) {
                            this.showMessage('File too large. Maximum size is 16MB.', 'error');
                            event.target.value = '';
                            return;
                        }
                        this.forms.file.file = file;
                    }
                },

                handleFileDrop(event) {
                    event.target.classList.remove('dragover');
                    const files = event.dataTransfer.files;
                    if (files.length > 0) {
                        const file = files[0];
                        if (file.size > 16 * 1024 * 1024) {
                            this.showMessage('File too large. Maximum size is 16MB.', 'error');
                            return;
                        }
                        this.forms.file.file = file;
                    }
                },

                handleDragOver(event) {
                    event.target.classList.add('dragover');
                },

                handleDragLeave(event) {
                    event.target.classList.remove('dragover');
                },

                formatInsights(insights) {
                                  if (Array.isArray(insights)) {
                                      return '<ul>' + insights.map(insight => {
                                          if (typeof insight === 'object' && insight.title) {
                                              return `<li><strong>${this.escapeHtml(insight.title)}</strong><br><em>${this.escapeHtml(insight.explanation)}</em></li>`;
                                          } else {
                                              return `<li>${this.escapeHtml(insight)}</li>`;
                                          }
                                      }).join('') + '</ul>';
                                  }
                                  return this.escapeHtml(insights);
                },

                formatHashtags(hashtags) {
                    if (Array.isArray(hashtags)) {
                        return hashtags.map(tag => `<span style="background: rgba(138, 43, 226, 0.1); color: #8a2be2; padding: 4px 8px; border-radius: 12px; margin: 2px; display: inline-block; font-size: 0.9rem;">#${this.escapeHtml(tag)}</span>`).join(' ');
                    }
                    return this.escapeHtml(hashtags);
                },

                escapeHtml(text) {
                    const div = document.createElement('div');
                    div.textContent = text;
                    return div.innerHTML;
                },

                resetCredentials() {
                    this.credentials = { email: '', password: '' };
                },

                resetForms() {
                    this.forms = {
                        comprehensive: { text: '', url: '', brands: '' },
                        social: { query: '', platforms: ['reddit'] },
                        text: { text: '', question: '' },
                        url: { url: '', question: '' },
                        file: { file: null, question: '' }
                    };
                },
                async exportToPDF() {
                    if (!this.results) {
                        this.showMessage('No analysis results to export', 'error');
                        return;
                    }

                    try {
                        this.loading = true;
                        this.showMessage('Generating PDF report...', 'success');

                        const response = await fetch(`${this.apiBase}/api/export/pdf`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                session_id: this.sessionId,
                                results: this.results,
                                analysis_type: this.activeTab
                            })
                        });

                        if (response.ok) {
                            const blob = await response.blob();
                            const url = window.URL.createObjectURL(blob);
                            const a = document.createElement('a');
                            a.href = url;
                            a.download = `market-analysis-${new Date().toISOString().split('T')[0]}.pdf`;
                            document.body.appendChild(a);
                            a.click();
                            document.body.removeChild(a);
                            window.URL.revokeObjectURL(url);
            
                            this.showMessage('PDF report downloaded successfully!', 'success');
                        } else {
                            const errorData = await response.json();
                            this.showMessage(errorData.error || 'Failed to generate PDF', 'error');
                        }
                    } catch (error) {
                        this.showMessage('Error generating PDF report', 'error');
                        console.error('PDF export error:', error);
                    } finally {
                        this.loading = false;
                    }
                },
                showMessage(text, type) {
                    this.message = text;
                    this.messageType = type;
                    setTimeout(() => {
                        this.message = '';
                    }, 5000);
                }
            }
        }
    </script>
</body>
</html>
